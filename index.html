<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>UFO</title>

<style>
  html,body{
    margin:0;
    padding:0;
    background:#000;
    height:100%;
    overflow:hidden;
    touch-action:none; /* prevents scroll on touch */
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
window.onload = function(){

  const C = Math.cos, S = Math.sin;

  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");

  let W = 0, H = 0, DPR = window.devicePixelRatio || 1;

  /* -----------------------------
     RESPONSIVE MOBILE-SAFE RESIZE
     ----------------------------- */
  function resize(){
    DPR = window.devicePixelRatio || 1;

    // CSS size
    const cssW = window.innerWidth;
    const cssH = window.innerHeight;

    // REAL pixel buffer size for crisp drawing
    canvas.width  = cssW * DPR;
    canvas.height = cssH * DPR;

    // Match internal math space
    W = canvas.width;
    H = canvas.height;

    // Scale the context so drawing uses logical pixels
    ctx.setTransform(DPR,0,0,DPR,0,0);

    ctx.fillStyle = "#000";
    ctx.fillRect(0,0,cssW,cssH);
  }
  resize();
  window.addEventListener("resize", resize);


  /* -----------------------------
     YOUR ORIGINAL VARIABLES
     ----------------------------- */
  let bool = 0, t = 0;
  let a = 0, b = 0;
  let A = 0, B = 0, X = 0, Y = 0;
  let R = 0.3, r = 0.25;
  let U = 0, D = 9;
  let g = 360 * Math.PI / 180;
  let e = 0;

  ctx.globalCompositeOperation = "lighter";
  ctx.lineWidth = 0.2;
  ctx.lineCap = "round";

  /* -----------------------------
     UFO SPRITE LOADING
     ----------------------------- */
  const ufo = new Image();
  ufo.src = "ufo.png";
  let ufoLoaded = false;
  let ufoW = 96, ufoH = 48;

  ufo.onload = () => {
    ufoLoaded = true;
    ufoH = Math.round(ufoW * (ufo.naturalHeight / ufo.naturalWidth));
  };

  /* -----------------------------
     MAIN FRAME FUNCTION
     ----------------------------- */
  function f_frame(l){
    ctx.save();
    ctx.globalCompositeOperation = "source-over";
    if(l !== 1){
      ctx.fillStyle = "rgba(0,0,0,0.02)";
      ctx.fillRect(0,0,canvas.width/DPR, canvas.height/DPR);
    }
    ctx.restore();

    for(let i=25;i--;){
      ctx.beginPath();
      if(D>450 || e){
        if(!e) e=1;
        if(D<0.1) e=0;
        t -= g; D -= 0.1;
      } else {
        t += g; D += 0.1;
      }
      let q = (R/r - 1) * t;

      let x = (R-r)*C(t) + D*C(q) + (A + (X-A)*(i/25)) + (r-R);
      let y = (R-r)*S(t) - D*S(q) + (B + (Y-B)*(i/25));

      if(a){ ctx.moveTo(a,b); ctx.lineTo(x,y); }

      ctx.strokeStyle = `hsla(${U%360},100%,50%,0.75)`;
      ctx.stroke();

      a = x; b = y;
    }
    U -= 0.5;
    A = X; B = Y;
  }

  /* -----------------------------
     INTERVAL MANAGEMENT
     ----------------------------- */
  let T = null;
  function ensureIntervalRestarted(){
    if(T) clearInterval(T);
    T = setInterval(() => f_frame(), 16);
  }

  /* -----------------------------
     POINTER COORD FIX FOR MOBILE
     ----------------------------- */
  function setPos(ev){
    const rect = canvas.getBoundingClientRect();

    // Convert CSS pixels â†’ canvas internal pixels
    X = (ev.clientX - rect.left) * DPR;
    Y = (ev.clientY - rect.top) * DPR;

    a = 0; b = 0;
    A = X; B = Y;

    R = ((X / W * 999) >> 0) / 999;
    r = ((Y / H * 999) >> 0) / 999;
    U = X / H * 360 >> 0;
    D = 9;

    ensureIntervalRestarted();
  }

  canvas.addEventListener("pointermove", setPos, {passive:true});
  canvas.addEventListener("pointerdown", e=>{
    setPos(e);
    f_frame(0);
    setTimeout(()=>f_frame(0),30);
  }, {passive:true});


  /* -----------------------------
     DRAW UFO SPRITE
     ----------------------------- */
  function drawLoop(){
    if(ufoLoaded){
      ctx.save();
      ctx.globalCompositeOperation = "source-over";
      ctx.drawImage(ufo, X/DPR - ufoW/2, Y/DPR - ufoH/2, ufoW, ufoH);
      ctx.restore();
    }
    requestAnimationFrame(drawLoop);
  }
  drawLoop();

  /* -----------------------------
     INITIAL STARTUP
     ----------------------------- */
  (function startup(){
    X = 300; Y = 290;
    A = X; B = Y;
    R = (X / W * 999 >> 0) / 999;
    r = (Y / H * 999 >> 0) / 999;
    U = X / H * 360 >> 0;
    D = 9;

    ensureIntervalRestarted();
    f_frame(1); f_frame(1);
  })();

};
</script>

</body>
</html>
